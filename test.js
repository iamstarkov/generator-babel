/* eslint-env mocha */
/* eslint-disable func-names, no-extra-bind */

var path = require('path');
var assert = require('yeoman-assert');
var helpers = require('yeoman-test');

var stringify = function stringify(obj) { return JSON.stringify(obj, null, 2); };

var generator = function() {
  return helpers.run(path.join(__dirname, './index.js'));
};

it('creates files', function(done) {
  generator().on('end', function() {
    assert.file('.babelrc');
    done();
  });
});

it('uses presets from options.config', function(done) {
  generator().withOptions({ config: { presets: ['es2015', 'stage-0'] }}).on('end', function() {
    assert.fileContent('.babelrc', /es2015/);
    assert.fileContent('.babelrc', /stage-0/);
    done();
  });
});

it('uses presets from arguments', function(done) {
  generator().withArguments(['es2015', 'stage-0']).on('end', function() {
    assert.fileContent('.babelrc', /es2015/);
    assert.fileContent('.babelrc', /stage-0/);
    done();
  });
});

it('uses plugins from options.config', function(done) {
  generator().withOptions({ config: { plugins: ['transform-strict-mode', 'transform-object-assign'] }}).on('end', function() {
    assert.fileContent('.babelrc', /transform-strict-mode/);
    assert.fileContent('.babelrc', /transform-object-assign/);
    done();
  });
});

it('uses plugins from options.plugins', function(done) {
  generator().withOptions({ plugins: ['transform-strict-mode', 'transform-object-assign'] }).on('end', function() {
    assert.fileContent('.babelrc', /transform-strict-mode/);
    assert.fileContent('.babelrc', /transform-object-assign/);
    done();
  });
});

it('uses any other option from options.config', function(done) {
  generator().withOptions({ config: { sourceMaps: true }}).on('end', function() {
    assert.fileContent('.babelrc', /"sourceMaps": true/);
    done();
  });
});

it('add presets and plugins with proper prefixes', function(done) {
  generator()
    .withOptions({ config: {
      presets: ['es2015', 'stage-0'],
      plugins: ['transform-strict-mode', 'transform-object-assign'],
      sourceMaps: true,
    }})
    .on('end', function() {
      assert.file('package.json');
      assert.fileContent('package.json', /babel-preset-stage-0/);
      assert.fileContent('package.json', /babel-preset-stage-0/);
      assert.fileContent('package.json', /babel-plugin-transform-strict-mode/);
      assert.fileContent('package.json', /babel-plugin-transform-object-assign/);
      done();
    });
});
